name: Production Deployment
on:
  push:
    branches: [main]
jobs:

  run_tests:
   name: "Testing"
   runs-on: ubuntu-latest
   env:
    working-directory: .
   defaults:
    run:
     working-directory: ${{ env.working-directory }}

   steps:
  # Чекаутим код
   - uses: actions/checkout@master
   # Устанавливаем python нужной версии
   - uses: actions/setup-python@v1
     with:
       python-version: '3.10.15'
       architecture: 'x64'
   - name: Install requirements
   # Устанавливаем зависимости
     run: pip install -r requirements.txt
   - name: black
     run: black --diff --check .
   - name: Run main
     run: python -m main 
   - name: Run tests
     run: pytest test_flask.py
     # run: coverage run test_flask.py
   - name: Tests report
     run: coverage report

  # converge:
  #   name: Converge
  #   # runs-on: [ubuntu-latest]
  #   runs-on: ubuntu-latest
  #   steps:

  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #       with:
  #         fetch-depth: 0

  #     - name: Converge
  #       uses: werf/actions/converge@v1.2
  #       with:
  #         env: production
  #         kube-config-base64-data: ${{ secrets.ADD_SECRET_DATA }}
  #       env:
  #         WERF_SET_ENV_URL: "envUrl=http://habrapp.example.com"
